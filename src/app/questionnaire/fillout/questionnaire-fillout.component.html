<ngx-loading [show]="saveandsubmit.isSubmitting"></ngx-loading>
<div id="questionnaire-fillout-page" class="page-container">
    <p-toast
        [showTransitionOptions]="'0ms'"
        [hideTransitionOptions]="'0ms'">
        <ng-template pTemplate>
            {{ 'save.error.invalid.label' | translate }}
        </ng-template>
    </p-toast>
    <div class="page-header block h-auto">
        <div *ngIf="questionnaire.set.datasource === null">
            <div class="title block heading text-center text-2xl pt-3">
                {{ 'questionnaire.error.notFound.label' | translate | titlecase }}
            </div>
            <div class="toolbar block text-center h-auto pt-0 mt-3">
                <button pButton type="button" class="button button-outlined w-auto text-left"
                    [disabled]="questionnaire.section.dataView.isLoading"
                    (click)="router.navigate(['Home'])">
                    <i class="fas fa-bars"></i>
                    &nbsp;&nbsp;<span>{{ !questionnaire.section.dataView.isLoading ? ('questionnaire.explore.label' | translate) : '' }}</span>
                </button>
            </div>
        </div>
        <div *ngIf="questionnaire.set.datasource !== null">
            <div class="toolbar fixed z-2" *ngIf="!saveandsubmit.isSuccess">
                <div class="left">
                    <div class="questionnairemenu-nav relative"
                        [ngClass]="{
                            'active': questionnaire.menu.panel.toggle
                        }">
                        <button pButton type="button" class="button p-button-gray w-auto"
                            [ngClass]="{
                                'button-outlined': questionnaire.menu.panel.toggle,
                                'active': questionnaire.menu.panel.toggle
                            }"
                            [disabled]="questionnaire.section.dataView.isLoading"
                            (click)="questionnaireMenuPanel.toggle($event)">
                            <i class="fas fa-bars"></i>
                        </button>
                        <p-overlayPanel #questionnaireMenuPanel
                            [dismissable]="true"
                            [showCloseIcon]="false"
                            [appendTo]="questionnaireMenuTemplate"
                            [showTransitionOptions]="'0ms'"
                            [hideTransitionOptions]="'0ms'"
                            (onShow)="questionnaire.menu.panel.toggle = true"
                            (onHide)="questionnaire.menu.panel.toggle = false"
                            styleClass="questionnairemenu-template">
                            <ng-template pTemplate >
                                <p-orderList
                                    [value]="questionnaire.menu.items">
                                    <ng-template let-qtnmenu pTemplate="item">
                                        <div (click)="router.navigate([qtnmenu.routerLink])">
                                            {{ (qtnmenu.label + '') | translate | titlecase }}
                                        </div>
                                    </ng-template>
                                </p-orderList>
                            </ng-template>
                        </p-overlayPanel>
                        <div #questionnaireMenuTemplate></div>
                    </div>
                </div>
                <div class="center">
                    <div class="questionnairesection-nav relative"
                        [ngClass]="{
                            'active': questionnaire.section.panel.toggle
                        }">
                        <div #previousButton class="previous">
                            <button pButton type="button" class="button button-outlined"
                                [disabled]="questionnaire.section.orderList.activeIndex === 0 || questionnaire.section.dataView.isLoading"
                                pTooltip="{{ 'previous.label' | translate | titlecase }}"
                                [tooltipDisabled]="questionnaire.section.orderList.activeIndex === 0 || questionnaire.section.dataView.isLoading"
                                [appendTo]="previousButton"
                                (click)="questionnaire.section.navigate.doPrevious()">
                                <i class="fas fa-long-arrow-alt-left"></i>
                            </button>
                        </div>
                        <div class="selected">
                            <button pButton type="button" class="button button-outlined"
                                [ngClass]="{
                                    'active': questionnaire.section.panel.toggle
                                }"
                                [disabled]="questionnaire.section.dataView.isLoading"
                                (click)="questionnaireSectionPanel.toggle($event)">
                                <span *ngIf="!questionnaire.section.dataView.isLoading">
                                    {{
                                        (questionnaire.section.datasource[questionnaire.section.orderList.activeIndex].titleName[appService.env.lang] | titlecase) +
                                        ' ' +
                                        questionnaire.section.datasource[questionnaire.section.orderList.activeIndex].no +
                                        ' / ' +
                                        questionnaire.section.datasource.length
                                    }}
                                </span>
                            </button>
                        </div>
                        <div #nextButton class="next">
                            <button pButton type="button" class="button button-outlined"
                                [disabled]="(questionnaire.section.orderList.activeIndex + 1) === questionnaire.section.datasource.length || questionnaire.section.dataView.isLoading"
                                pTooltip="{{ 'next.label' | translate | titlecase }}"
                                [tooltipDisabled]="(questionnaire.section.orderList.activeIndex + 1) === questionnaire.section.datasource.length || questionnaire.section.dataView.isLoading"
                                [appendTo]="nextButton"
                                (click)="questionnaire.section.navigate.doNext()">
                                <i class="fas fa-long-arrow-alt-right"></i>
                            </button>
                        </div>
                        <p-overlayPanel #questionnaireSectionPanel
                            [dismissable]="true"
                            [showCloseIcon]="false"
                            [appendTo]="questionnaireSectionTemplate"
                            [showTransitionOptions]="'0ms'"
                            [hideTransitionOptions]="'0ms'"
                            (onShow)="questionnaire.section.panel.toggle = true"
                            (onHide)="questionnaire.section.panel.toggle = false"
                            styleClass="questionnairesection-template">
                            <ng-template pTemplate >
                                <p-orderList
                                    [value]="questionnaire.section.datasource"
                                    (onSelectionChange)="
                                        questionnaireSectionPanel.hide();
                                        questionnaire.section.orderList.doSelection($event.value)
                                    ">
                                    <ng-template let-qtnsection pTemplate="item">
                                        {{ (qtnsection.titleName[appService.env.lang] | titlecase) + ' ' + qtnsection.no }}
                                    </ng-template>
                                </p-orderList>
                            </ng-template>
                        </p-overlayPanel>
                        <div #questionnaireSectionTemplate></div>
                    </div>
                </div>
                <div class="right text-right">
                    <button pButton type="button" class="button p-button-warning" *ngIf="!saveandsubmit.isSaving"
                        [disabled]="
                            questionnaire.section.dataView.isLoading ||
                            questionnaire.section.datasource[questionnaire.section.orderList.activeIndex].disableStatus === 'Y'
                        "
                        (click)="saveandsubmit.doSave()">
                        <span *ngIf="!questionnaire.section.dataView.isLoading">{{ 'save.label' | translate | titlecase }}</span>
                    </button>
                    <i class="fas fa-spin fa-spinner" *ngIf="saveandsubmit.isSaving"></i>
                </div>
            </div>
            <div class="title block heading"
                [ngClass]="{
                    'p-3': saveandsubmit.isSuccess
                }">
                <p-panel [showHeader]="false" class="questionnaireset">
                    <div>
                        <div class="namedescription">
                            <div class="name" *ngIf="questionnaire.set.datasource.name !== null">
                                {{ !questionnaire.section.dataView.isLoading ? questionnaire.set.datasource.name[appService.env.lang] : '&nbsp;' }}
                            </div>
                            <div class="description paragraph" *ngIf="questionnaire.set.datasource.description !== null">
                                {{ !questionnaire.section.dataView.isLoading ? questionnaire.set.datasource.description[appService.env.lang] : '&nbsp;' }}
                            </div>
                        </div>
                        <div
                            *ngIf="
                                questionnaire.set.datasource.cancelStatus === 'N' &&
                                questionnaire.section.orderList.activeIndex === 0 &&
                                !saveandsubmit.isSuccess
                            ">
                            <div class="notice paragraph" *ngIf="questionnaire.set.datasource.notice !== null">
                                <span class="text-pink-500 font-semibold">
                                    {{ !questionnaire.section.dataView.isLoading ? ('notice.label' | translate | titlecase) : '&nbsp;' }}&nbsp;
                                </span>
                                {{ !questionnaire.section.dataView.isLoading ? questionnaire.set.datasource.notice[appService.env.lang] : '&nbsp;' }}
                            </div>
                        </div>
                        <div *ngIf="saveandsubmit.isSuccess">
                            <div class="notice paragraph">
                                <div class="font-semibold text-lg">
                                    {{ 'questionnaire.submitted.date.label' | translate }}
                                </div>
                                <div class="font-light">
                                    06 October 2021 ,3:10:36 pm
                                </div>
                                <div class="text-xl mt-5">
                                    {{ 'questionnaire.submitted.thankyou.label' | translate }}
                                </div>
                                <button pButton type="button" class="button button-outlined w-auto text-left text-sm mt-4"
                                    (click)="router.navigate(['Home'])">
                                    <i class="fas fa-bars"></i>
                                    &nbsp;&nbsp;<span>{{ 'questionnaire.explore.label' | translate }}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </p-panel>
            </div>
        </div>
    </div>
    <div class="page-body">
        <p-dataView
            class="questionnairesections"
            [value]="questionnaire.section.datasource"
            [loading]="questionnaire.section.dataView.isLoading"
            loadingIcon="fas fa-spin fa-spinner"
            layout="grid"
            *ngIf="
                questionnaire.set.datasource !== null &&
                !saveandsubmit.isSuccess
            ">
            <ng-template let-qtnsection pTemplate="gridItem">
                <div class="questionnairesection-tabpanel" *ngIf="!questionnaire.section.dataView.isLoading"
                    [ngClass]="{
                        'block': qtnsection.ID === questionnaire.section.datasource[questionnaire.section.orderList.activeIndex].ID,
                        'hidden': qtnsection.ID !== questionnaire.section.datasource[questionnaire.section.orderList.activeIndex].ID
                    }">
                    <div class="questionnairesection">
                        <p-panel [showHeader]="false">
                            <div class="name">
                                <span class="titlename">{{ (qtnsection.titleName[appService.env.lang] | titlecase) + ' ' +  qtnsection.no }}</span>
                                &nbsp;&nbsp;{{ qtnsection.name[appService.env.lang] }}
                            </div>
                        </p-panel>
                    </div>
                    <div class="questionnairequestions" *ngFor="let qtnquestion of questionnaire.question[qtnsection.ID].datasource">
                        <p-panel
                            [showHeader]="false"
                            [styleClass]="((qtnsection.disableStatus === 'N' && qtnquestion.disableStatus === 'N' && qtnquestion.errorStatus === 'Y') ? 'question-error' : '')">
                            <div class="p-component-overlay"
                                *ngIf="
                                    qtnsection.disableStatus === 'Y' ||
                                    qtnquestion.disableStatus === 'Y'
                                ">
                            </div>
                            <div class="questionnairequestion paragraph"
                                [ngClass]="{
                                    'p-disabled': (qtnsection.disableStatus === 'Y' || qtnquestion.disableStatus === 'Y')
                                }">
                                <ul class="table">
                                    <li class="no">
                                        {{ qtnquestion.no + '.' }}
                                    </li>
                                    <li class="name">
                                        {{ qtnquestion.name[appService.env.lang] }}
                                        <div class="description" *ngIf="qtnquestion.description[appService.env.lang] !== null">
                                            {{ qtnquestion.description[appService.env.lang] }}
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="questionnaireanswerset paragraph" *ngFor="let qtnanswerset of questionnaire.answerSet[qtnquestion.ID].datasource"
                                [ngClass]="{
                                    'p-disabled': (qtnsection.disableStatus === 'Y' || qtnquestion.disableStatus === 'Y')
                                }">
                                <div class="titlename underline" *ngIf="qtnanswerset.titleName[appService.env.lang] !== null">
                                    {{ qtnanswerset.titleName[appService.env.lang] }}
                                </div>
                                <div class="questionnaireanswer" *ngFor="let qtnanswer of questionnaire.answer[qtnanswerset.ID].datasource">
                                    <div
                                        *ngIf="
                                            qtnanswerset.inputType !== null &&
                                            qtnanswerset.inputType.type === null &&
                                            qtnanswer.inputType === null
                                        ">
                                        <div class="institute" *ngIf="qtnanswerset.inputType.inputType === inputType.institute">
                                            <ul class="table name">
                                                <li class="label">
                                                    {{ 'institute.name.label' | translate | titlecase }}
                                                </li>
                                                <li class="viewanswer">
                                                    {{ userInfo.instituteName[appService.env.lang] | titlecase }}
                                                </li>
                                            </ul>
                                            <ul class="table faculty">
                                                <li class="label">
                                                    {{ 'institute.faculty.label' | translate | titlecase }}
                                                </li>
                                                <li class="viewanswer">
                                                    {{ userInfo.facultyName[appService.env.lang] | titlecase }}
                                                </li>
                                            </ul>
                                            <ul class="table majorsubject">
                                                <li class="label">
                                                    {{ 'institute.majorSubject.label' | translate | titlecase }}
                                                </li>
                                                <li class="viewanswer">
                                                    {{ userInfo.programName[appService.env.lang] | titlecase }}
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="personaldetail" *ngIf="qtnanswerset.inputType.inputType === inputType.personalDetail">
                                            <ul class="table fullname">
                                                <li class="label">
                                                    {{ 'personalDetail.fullName.label' | translate | titlecase }} (TH)
                                                </li>
                                                <li class="viewanswer">
                                                    {{ userInfo.titlePrefix.th + userInfo.firstName.th + (userInfo.middleName !== null ? (' ' + userInfo.middleName.th) : '') + ' ' + userInfo.lastName.th }}
                                                </li>
                                            </ul>
                                            <ul class="table fullname">
                                                <li class="label">
                                                    {{ 'personalDetail.fullName.label' | translate | titlecase }} (EN)
                                                </li>
                                                <li class="viewanswer">
                                                    {{ (userInfo.titlePrefix.en | titlecase) + (userInfo.firstName.en | titlecase) + (userInfo.middleName !== null ? (' ' + (userInfo.middleName.en | titlecase)) : '') + ' ' + (userInfo.lastName.en | titlecase) }}
                                                </li>
                                            </ul>
                                            <ul class="table idcard">
                                                <li class="label">
                                                    {{ 'personalDetail.IDCard.label' | translate | titlecase }}
                                                </li>
                                                <li class="viewanswer">
                                                    {{ userInfo.IDCard }}
                                                </li>
                                            </ul>
                                            <ul class="table studentcode">
                                                <li class="label">
                                                    {{ 'personalDetail.studentCode.label' | translate | titlecase }}
                                                </li>
                                                <li class="viewanswer">
                                                    {{ userInfo.studentCode }}
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="address" *ngIf="qtnanswerset.inputType.inputType === inputType.address">
                                            <ng-container *ngTemplateOutlet="
                                                questionnaireAddressTemplate;
                                                context: {
                                                    qtnanswerset: qtnanswerset,
                                                    qtnanswer: qtnanswer,
                                                    formField: questionnaire.answer[qtnanswerset.ID].formField.address,
                                                    validators: questionnaire.answer[qtnanswerset.ID].validators
                                                }">
                                            </ng-container>
                                        </div>
                                    </div>
                                    <ul class="table choice"
                                        *ngIf="
                                            qtnanswerset.inputType !== null &&
                                            (
                                                (qtnanswerset.inputType.inputType === inputType.singleChoice && qtnanswerset.inputType.type === 'radio') ||
                                                (qtnanswerset.inputType.inputType === inputType.multipleChoice && qtnanswerset.inputType.type === 'checkbox')
                                            )
                                        ">
                                        <li class="inputtype" *ngIf="qtnanswer.inputType === null">
                                            <ng-container *ngTemplateOutlet="
                                                questionnaireInputTypeTemplate;
                                                context: {
                                                    qtnanswerset: qtnanswerset,
                                                    qtnanswer: qtnanswer,
                                                    formField: questionnaire.answer[qtnanswerset.ID].formField
                                                }">
                                            </ng-container>
                                        </li>
                                        <li class="choiceorder" *ngIf="qtnanswer.choiceOrder !== null">
                                            <label [for]="qtnanswer.ID">
                                                {{ qtnanswer.choiceOrder }}
                                            </label>
                                        </li>
                                        <li class="namedescription" *ngIf="qtnanswer.name[appService.env.lang] !== null">
                                            <label class="name" [for]="qtnanswer.ID">
                                                {{ qtnanswer.name[appService.env.lang] }}
                                            </label>
                                            <div class="description" *ngIf="qtnanswer.description[appService.env.lang] !== null">
                                                {{ qtnanswer.description[appService.env.lang] }}
                                            </div>
                                            <div *ngIf="qtnanswer.specify !== null">
                                                <div class="specify p-fluid" *ngFor="let qtnanswerspecify of qtnanswer.specify">
                                                    <ng-container *ngTemplateOutlet="
                                                        questionnaireInputTypeTemplate;
                                                        context: {
                                                            qtnanswerset: qtnanswerset,
                                                            qtnanswer: qtnanswer,
                                                            formField: questionnaire.answer[qtnanswerset.ID],
                                                            qtnanswerspecify: qtnanswerspecify
                                                        }">
                                                    </ng-container>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                    <ul class="table text"
                                        *ngIf="
                                            qtnanswerset.inputType === null &&
                                            (
                                                (qtnanswer.inputType.inputType === inputType.shortAnswerText && qtnanswer.inputType.type === 'text') ||
                                                (qtnanswer.inputType.inputType === inputType.longAnswerText && qtnanswer.inputType.type === 'text') ||
                                                (qtnanswer.inputType.inputType === inputType.dropdown && qtnanswer.inputType.type === 'select')
                                            )
                                        ">
                                        <li class="inputtype" *ngIf="qtnanswer.inputType !== null">
                                            <div class="p-fluid">
                                                <div class="namedescription" *ngIf="qtnanswer.name[appService.env.lang] !== null">
                                                    <div class="name font-normal" *ngIf="qtnanswer.name[appService.env.lang] !== null">
                                                        {{ qtnanswer.name[appService.env.lang] }}
                                                    </div>
                                                    <div class="description" *ngIf="qtnanswer.description[appService.env.lang] !== null">
                                                        {{ qtnanswer.description[appService.env.lang] }}
                                                    </div>
                                                </div>
                                                <ng-container *ngTemplateOutlet="
                                                    questionnaireInputTypeTemplate;
                                                    context: {
                                                        qtnanswerset: qtnanswerset,
                                                        qtnanswer: qtnanswer,
                                                        formField: questionnaire.answer[qtnanswerset.ID].formField
                                                    }">
                                                </ng-container>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                    <div class="text-center mt-3" *ngIf="(questionnaire.section.orderList.activeIndex + 1) === questionnaire.section.datasource.length">
                        <button pButton type="button" class="submit button p-button-rounded p-button-success"
                            (click)="saveandsubmit.doSubmit()">
                            <span *ngIf="!saveandsubmit.isSubmitting">
                                {{ 'questionnaire.submit.label' | translate | titlecase }}
                            </span>
                            <span *ngIf="saveandsubmit.isSubmitting">
                                {{ 'questionnaire.submitting.label' | translate | titlecase }}
                            </span>
                        </button>
                        <!--
                        <button pButton type="button" class="submit button p-button-rounded p-button-success"
                            [disabled]="
                                questionnaire.section.dataView.isLoading ||
                                !saveandsubmit.isValid
                            "
                            (click)="saveandsubmit.doSubmit()">
                            <span *ngIf="!saveandsubmit.isSubmitting">
                                {{ 'questionnaire.submit.label' | translate | titlecase }}
                            </span>
                            <span *ngIf="saveandsubmit.isSubmitting">
                                {{ 'questionnaire.submitting.label' | translate | titlecase }}
                            </span>
                        </button>
                        -->
                    </div>
                </div>
            </ng-template>
        </p-dataView>
    </div>
</div>
<ng-template #questionnaireAddressTemplate
    let-qtnanswerset="qtnanswerset"
    let-qtnanswer="qtnanswer"
    let-formField="formField"
    let-validators="validators">
    <ul class="table {{ addressField.name.toLowerCase() }}" *ngFor="let addressField of addressFields">
        <li class="label">
            <label [for]="addressField.name.toLowerCase() + qtnanswer.ID">
                {{ 'address.' + addressField.name + '.label' | translate }}
            </label>
        </li>
        <li class="editanswer p-fluid">
            <input pInputText trimOnBlur empty2Null type="text"
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [id]="addressField.name.toLowerCase() + qtnanswer.ID"
                [maxlength]="addressField.length !== undefined ? addressField.length : ''"
                (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
                *ngIf="
                    addressField.inputType === inputType.shortAnswerText &&
                    addressField.type === 'text'
                "
            />
            <div
                [ngClass]="{
                    'formfield-error': validators.isEmail[qtnanswer.ID] === false
                }"
                *ngIf="
                    addressField.inputType === inputType.shortAnswerText &&
                    addressField.type === 'email'
                ">
                <input pInputText trimOnBlur empty2Null type="text"
                    [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                    [id]="addressField.name.toLowerCase() + qtnanswer.ID"
                    [maxlength]="addressField.length !== undefined ? addressField.length : ''"
                    (ngModelChange)="
                        validators.isEmail[qtnanswer.ID] = appService.doValidatorEmail(formField[addressField.name][qtnanswer.ID]);
                        doWatchModelChange($event, qtnanswerset)
                    "
                />
                <p-message
                    severity="error"
                    text="{{ 'error.email.invalid.label' | translate }}"
                    *ngIf="validators.isEmail[qtnanswer.ID] === false">
                </p-message>
            </div>
            <p-inputNumber
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [mode]="addressField.mode !== undefined ? addressField.mode : ''"
                [maxlength]="addressField.length !== undefined ? addressField.length : 0"
                [minFractionDigits]="addressField.decimalPoint !== undefined ? addressField.decimalPoint : 0"
                [maxFractionDigits]="addressField.decimalPoint !== undefined ? addressField.decimalPoint : 0"
                [useGrouping]="addressField.useGrouping !== undefined ? addressField.useGrouping : true"
                (onInput)="
                    formField[addressField.name][qtnanswer.ID] = $event.value;
                    doWatchModelChange(formField[addressField.name][qtnanswer.ID], qtnanswerset)
                "
                *ngIf="
                    addressField.inputType === inputType.shortAnswerText &&
                    addressField.type === 'number'
                ">
            </p-inputNumber>
            <p-inputMask
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [mask]="addressField.mask !== undefined ? addressField.mask : ''"
                (onBlur)="
                    formField[addressField.name][qtnanswer.ID] = (($event.originalTarget.value === '' || $event.originalTarget.value.length === 0) ? null : $event.originalTarget.value);
                    doWatchModelChange(formField[addressField.name][qtnanswer.ID], qtnanswerset)
                "
                *ngIf="
                    addressField.inputType === inputType.shortAnswerText &&
                    addressField.type === 'mask'
                ">
            </p-inputMask>
            <ng-select
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [id]="addressField.name.toLowerCase() + qtnanswer.ID"
                [searchable]="false"
                placeholder="{{ 'placeholder.selectItem.label' | translate | titlecase }}"
                notFoundText="{{ 'error.noItemsFound.label' | translate }}"
                (ngModelChange)="
                    doSelectOnChange(addressField.name, formField[addressField.name][qtnanswer.ID], qtnanswerset.ID, qtnanswer.ID);
                    doWatchModelChange($event, qtnanswerset)
                "
                *ngIf="
                    addressField.name === 'country' &&
                    addressField.inputType === inputType.dropdown &&
                    addressField.type === 'select'
                ">
                <ng-option *ngFor="let country of country['master'].datasource" [value]="country">
                    {{ country.name[appService.env.lang] }}
                </ng-option>
            </ng-select>
            <ng-select
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [id]="addressField.name.toLowerCase() + qtnanswer.ID"
                [searchable]="false"
                placeholder="{{ 'placeholder.selectItem.label' | translate | titlecase }}"
                notFoundText="{{ 'error.noItemsFound.label' | translate }}"
                (ngModelChange)="
                    doSelectOnChange(addressField.name, formField[addressField.name][qtnanswer.ID], qtnanswerset.ID, qtnanswer.ID);
                    doWatchModelChange($event, qtnanswerset)
                "
                *ngIf="
                    addressField.name === 'province' &&
                    addressField.inputType === inputType.dropdown &&
                    addressField.type === 'select'
                ">
                <ng-option *ngFor="let province of province[qtnanswer.ID].datasource" [value]="province">
                    {{ province.name[appService.env.lang] }}
                </ng-option>
            </ng-select>
            <ng-select
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [id]="addressField.name.toLowerCase() + qtnanswer.ID"
                [searchable]="false"
                placeholder="{{ 'placeholder.selectItem.label' | translate | titlecase }}"
                notFoundText="{{ 'error.noItemsFound.label' | translate }}"
                (ngModelChange)="
                    doSelectOnChange(addressField.name, formField[addressField.name][qtnanswer.ID], qtnanswerset.ID, qtnanswer.ID);
                    doWatchModelChange($event, qtnanswerset)
                "
                *ngIf="
                    addressField.name === 'district' &&
                    addressField.inputType === inputType.dropdown &&
                    addressField.type === 'select'
                ">
                <ng-option *ngFor="let district of district[qtnanswer.ID].datasource" [value]="district">
                    {{ district.name[appService.env.lang] }}
                </ng-option>
            </ng-select>
            <ng-select
                [(ngModel)]="formField[addressField.name][qtnanswer.ID]"
                [id]="addressField.name.toLowerCase() + qtnanswer.ID"
                [searchable]="false"
                placeholder="{{ 'placeholder.selectItem.label' | translate | titlecase }}"
                notFoundText="{{ 'error.noItemsFound.label' | translate }}"
                (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
                *ngIf="
                    addressField.name === 'subdistrict' &&
                    addressField.inputType === inputType.dropdown &&
                    addressField.type === 'select'
                ">
                <ng-option *ngFor="let subdistrict of subdistrict[qtnanswer.ID].datasource" [value]="subdistrict">
                    {{ subdistrict.name[appService.env.lang] }}
                </ng-option>
            </ng-select>
        </li>
    </ul>
</ng-template>
<ng-template #questionnaireInputTypeTemplate
    let-qtnanswerset="qtnanswerset"
    let-qtnanswer="qtnanswer"
    let-formField="formField"
    let-qtnanswerspecify="qtnanswerspecify">
    <div *ngIf="qtnanswerset.inputType !== null && qtnanswerspecify === undefined">
        <p-radioButton
            [(ngModel)]="formField.singleChoice"
            [inputId]="qtnanswer.ID"
            [name]="formField.singleChoice"
            [value]="qtnanswer"
            (ngModelChange)="
                doRadiobuttonOnChange(qtnanswer);
                doWatchModelChange($event, qtnanswerset)
            "
            *ngIf="
                qtnanswerset.inputType.inputType === inputType.singleChoice &&
                qtnanswerset.inputType.type === 'radio'
            ">
        </p-radioButton>
        <p-checkbox
            [(ngModel)]="formField.multipleChoice"
            [inputId]="qtnanswer.ID"
            [name]="formField.multipleChoice"
            [value]="qtnanswer"
            checkboxIcon="fas fa-times"
            (ngModelChange)="
                doCheckboxOnChange({ selected: qtnanswer, value: formField.multipleChoice });
                doWatchModelChange($event, qtnanswerset)
            "
            *ngIf="
                qtnanswerset.inputType.inputType === inputType.multipleChoice &&
                qtnanswerset.inputType.type === 'checkbox'
            ">
        </p-checkbox>
    </div>
    <div *ngIf="qtnanswerset.inputType === null && qtnanswer.inputType !== null && qtnanswerspecify === undefined">
        <input pInputText trimOnBlur empty2Null type="text"
            [(ngModel)]="formField.shortAnswerText[qtnanswer.ID]"
            [maxlength]="qtnanswer.inputType.length !== null ? qtnanswer.inputType.length : ''"
            (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
            *ngIf="
                qtnanswer.inputType.inputType === inputType.shortAnswerText &&
                qtnanswer.inputType.type === 'text'
            "
        />
        <textarea pInputTextarea trimOnBlur empty2Null
            [(ngModel)]="formField.longAnswerText[qtnanswer.ID]"
            [maxlength]="qtnanswer.inputType.length !== null ? qtnanswer.inputType.length : ''"
            [autoResize]="true"
            (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
            *ngIf="
                qtnanswer.inputType.inputType === inputType.longAnswerText &&
                qtnanswer.inputType.type === 'text'

            ">
        </textarea>
        <ng-select
            [(ngModel)]="formField.select[qtnanswer.ID]"
            [searchable]="false"
            placeholder="{{ 'placeholder.selectItem.label' | translate | titlecase }}"
            notFoundText="{{ 'error.noItemsFound.label' | translate }}"
            (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
            *ngIf="
                qtnanswer.inputType.inputType === inputType.dropdown &&
                qtnanswer.inputType.type === 'select' &&
                qtnanswer.inputType.mode === 'province'
            ">
            <ng-option *ngFor="let province of province['th'].datasource" [value]="province">
                {{ province.name[appService.env.lang] }}
            </ng-option>
        </ng-select>
    </div>
    <div *ngIf="qtnanswerspecify !== undefined">
        <input pInputText trimOnBlur empty2Null type="text"
            [ngClass]="{
                'p-disabled': (
                    !(formField.formField.singleChoice !== null && formField.formField.singleChoice.ID === qtnanswer.ID) &&
                    !(formField.formField.multipleChoice.length > 0 && appService.doArrayFilter(formField.formField.multipleChoice, { field: 'ID', value: qtnanswer.ID }).length > 0)
                )
            }"
            [(ngModel)]="formField.formField.shortAnswerText[qtnanswer.ID]"
            (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
            [maxlength]="qtnanswerspecify.length !== null ? qtnanswerspecify.length : ''"
            *ngIf="
                qtnanswerspecify.inputType === inputType.shortAnswerText &&
                qtnanswerspecify.type === 'text'
            "
        />
        <p-inputNumber
            [(ngModel)]="formField.formField.shortAnswerText[qtnanswer.ID]"
            [mode]="qtnanswerspecify.mode"
            [maxlength]="qtnanswerspecify.length !== null ? qtnanswerspecify.length : 0"
            [minFractionDigits]="qtnanswerspecify.decimalPoint !== null ? qtnanswerspecify.decimalPoint : 0"
            [maxFractionDigits]="qtnanswerspecify.decimalPoint !== null ? qtnanswerspecify.decimalPoint : 0"
            [useGrouping]="qtnanswerspecify.useGrouping !== null ? qtnanswerspecify.useGrouping : true"
            [disabled]="
                !(formField.formField.singleChoice !== null && formField.formField.singleChoice.ID === qtnanswer.ID) &&
                !(formField.formField.multipleChoice.length > 0 && appService.doArrayFilter(formField.formField.multipleChoice, { field: 'ID', value: qtnanswer.ID }).length > 0)
            "
            (onInput)="
                formField.formField.shortAnswerText[qtnanswer.ID] = $event.value;
                doWatchModelChange(formField.formField.shortAnswerText[qtnanswer.ID], qtnanswerset)
            "
            *ngIf="
                qtnanswerspecify.inputType === inputType.shortAnswerText &&
                qtnanswerspecify.type === 'number'
            ">
        </p-inputNumber>
        <textarea pInputTextarea trimOnBlur empty2Null
            [ngClass]="{
                'p-disabled': (
                    !(formField.formField.singleChoice !== null && formField.formField.singleChoice.ID === qtnanswer.ID) &&
                    !(formField.formField.multipleChoice.length > 0 && appService.doArrayFilter(formField.formField.multipleChoice, { field: 'ID', value: qtnanswer.ID }).length > 0)
                )
            }"
            [(ngModel)]="formField.formField.longAnswerText[qtnanswer.ID]"
            (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
            [maxlength]="qtnanswerspecify.length !== null ? qtnanswerspecify.length : ''"
            [autoResize]="true"
            *ngIf="
                qtnanswerspecify.inputType === inputType.longAnswerText &&
                qtnanswerspecify.type === 'text'
            ">
        </textarea>
        <ng-select
            [(ngModel)]="formField.formField.select[qtnanswer.ID]"
            [searchable]="false"
            placeholder="{{ 'placeholder.selectItem.label' | translate | titlecase }}"
            notFoundText="{{ 'error.noItemsFound.label' | translate }}"
            (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
            [readonly]="
                !(formField.formField.singleChoice !== null && formField.formField.singleChoice.ID === qtnanswer.ID) &&
                !(formField.formField.multipleChoice.length > 0 && appService.doArrayFilter(formField.formField.multipleChoice, { field: 'ID', value: qtnanswer.ID }).length > 0)
            "
            *ngIf="
                qtnanswerspecify.inputType === inputType.dropdown &&
                qtnanswerspecify.type === 'select' &&
                qtnanswerspecify.mode === 'country'
            ">
            <ng-option *ngFor="let country of country['master'].datasource" [value]="country">
                {{ country.name[appService.env.lang] }}
            </ng-option>
        </ng-select>
        <div class="questionnaireanswer" *ngFor="let qtnanswerspecifyitem of qtnanswerspecify.items">
            <ul class="table choice" >
                <li class="inputtype">
                    <p-radioButton
                        [(ngModel)]="formField._formField[qtnanswer.ID].singleChoice"
                        [inputId]="qtnanswerspecifyitem.ID"
                        [name]="formField._formField[qtnanswer.ID].singleChoice"
                        [value]="qtnanswerspecifyitem"
                        [disabled]="
                            !(formField.formField.singleChoice !== null && formField.formField.singleChoice.ID === qtnanswer.ID) &&
                            !(formField.formField.multipleChoice.length > 0 && appService.doArrayFilter(formField.formField.multipleChoice, { field: 'ID', value: qtnanswer.ID }).length > 0)
                        "
                        (ngModelChange)="
                            doRadiobuttonOnChange(qtnanswer, { selected: qtnanswerspecifyitem, items: qtnanswerspecify.items });
                            doWatchModelChange($event, qtnanswerset)
                        "
                        *ngIf="
                            qtnanswerspecify.inputType === inputType.singleChoice &&
                            qtnanswerspecify.type === 'radio'
                        ">
                    </p-radioButton>
                    <p-checkbox
                        [(ngModel)]="formField._formField[qtnanswer.ID].multipleChoice"
                        [inputId]="qtnanswerspecifyitem.ID"
                        [name]="formField._formField[qtnanswer.ID].multipleChoice"
                        [value]="qtnanswerspecifyitem"
                        checkboxIcon="fas fa-times"
                        [disabled]="
                            !(formField.formField.singleChoice !== null && formField.formField.singleChoice.ID === qtnanswer.ID) &&
                            !(formField.formField.multipleChoice.length > 0 && appService.doArrayFilter(formField.formField.multipleChoice, { field: 'ID', value: qtnanswer.ID }).length > 0)
                        "
                        (ngModelChange)="
                            doCheckboxOnChange({ selected: qtnanswer }, { selected: qtnanswerspecifyitem, value: formField._formField[qtnanswer.ID].multipleChoice });
                            doWatchModelChange($event, qtnanswerset)
                        "
                        *ngIf="
                            qtnanswerspecify.inputType === inputType.multipleChoice &&
                            qtnanswerspecify.type === 'checkbox'
                        ">
                    </p-checkbox>
                </li>
                <li class="choiceorder" *ngIf="qtnanswerspecifyitem.choiceOrder !== null">
                    <label [for]="qtnanswerspecifyitem.ID">{{ qtnanswerspecifyitem.choiceOrder }}</label>
                </li>
                <li class="namedescription" *ngIf="qtnanswerspecifyitem.name[appService.env.lang] !== null">
                    <label class="name" [for]="qtnanswerspecifyitem.ID">{{ qtnanswerspecifyitem.name[appService.env.lang] }}</label>
                    <div class="description" *ngIf="qtnanswerspecifyitem.description[appService.env.lang] !== null">
                        {{ qtnanswerspecifyitem.description[appService.env.lang] }}
                    </div>
                    <div *ngIf="qtnanswerspecifyitem.specify !== null">
                        <div class="specify p-fluid">
                            <textarea pInputTextarea trimOnBlur empty2Null
                                [ngClass]="{
                                    'p-disabled': (
                                        !(formField._formField[qtnanswer.ID].singleChoice !== null && formField._formField[qtnanswer.ID].singleChoice.ID === qtnanswerspecifyitem.ID) &&
                                        !(formField._formField[qtnanswer.ID].multipleChoice.length > 0 && appService.doArrayFilter(formField._formField[qtnanswer.ID].multipleChoice, { field: 'ID', value: qtnanswerspecifyitem.ID }).length > 0)
                                    )
                                }"
                                [(ngModel)]="formField._formField[qtnanswer.ID].longAnswerText[qtnanswerspecifyitem.ID]"
                                (ngModelChange)="doWatchModelChange($event, qtnanswerset)"
                                [maxlength]="qtnanswerspecifyitem.specify[0].length !== null ? qtnanswerspecifyitem.specify[0].length : ''"
                                [autoResize]="true"
                                *ngIf="
                                    qtnanswerspecifyitem.specify[0].inputType === inputType.longAnswerText &&
                                    qtnanswerspecifyitem.specify[0].type === 'text'
                                ">
                            </textarea>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</ng-template>
